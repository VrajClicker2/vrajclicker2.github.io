<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vraj Clicker 2</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --text: #f8fafc;
            --accent: #22d3ee;
            --gold: #fbbf24;
            --danger: #ef4444;
        }

        /* Prevent Selection & Context Menu */
        * {
            user-select: none;
            -webkit-user-select: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%);
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .screen {
            background: var(--card);
            backdrop-filter: blur(12px);
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .hidden { display: none !important; }

        h1 { font-size: 2.5rem; margin-bottom: 1.5rem; letter-spacing: -1px; color: var(--accent); }
        h3 { color: var(--gold); margin-bottom: 1rem; }

        input {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(15, 23, 42, 0.6);
            color: white;
            font-size: 1rem;
            box-sizing: border-box;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover { filter: brightness(1.2); transform: translateY(-2px); }
        button:active { transform: translateY(0); }

        /* Game Specifics */
        #game-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, #0891b2 100%);
            border: 8px solid rgba(255,255,255,0.1);
            font-size: 1.8rem;
            margin: 20px auto;
            color: white;
            box-shadow: 0 0 30px rgba(34, 211, 238, 0.3);
        }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .stat-card { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; }

        /* Custom Notification */
        #game-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            padding: 12px 24px;
            border-radius: 50px;
            z-index: 1000;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        /* Leaderboard */
        .lb-container {
            margin-top: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        table { width: 100%; text-align: left; border-collapse: collapse; }
        th { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; padding-bottom: 8px; }
        td { padding: 6px 0; font-size: 0.9rem; }
        .rank-1 { color: var(--gold); font-weight: bold; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="game-alert" class="hidden"></div>

    <div id="screen-menu" class="screen">
        <h1>Vraj Clicker 2</h1>
        <button onclick="showScreen('screen-login')">Login</button>
        <button onclick="showScreen('screen-signup')" style="background:#4834d4">Sign Up</button>
    </div>

    <div id="screen-login" class="screen hidden">
        <h3>Welcome Back</h3>
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-pass" placeholder="Password">
        <button id="btn-do-login">Login to Account</button>
        <button onclick="showScreen('screen-menu')" style="background:transparent; color:#94a3b8; font-size:0.8rem">Go Back</button>
    </div>

    <div id="screen-signup" class="screen hidden">
        <h3>Create Character</h3>
        <input type="text" id="sign-user" placeholder="Username (Display Name)">
        <input type="email" id="sign-email" placeholder="Email Address">
        <input type="password" id="sign-pass" placeholder="Password (6+ chars)">
        <button id="btn-do-signup">Create & Verify</button>
        <button onclick="showScreen('screen-menu')" style="background:transparent; color:#94a3b8; font-size:0.8rem">Go Back</button>
    </div>

    <div id="screen-verify" class="screen hidden">
        <h3>ðŸ“¨ Check Email</h3>
        <p>Verify your email to enter the leaderboard.</p>
        <button id="btn-check-verify">I Have Verified</button>
        <button onclick="location.reload()" style="background:var(--danger)">Logout</button>
    </div>

    <div id="screen-game" class="screen hidden">
        <h3 id="display-name">Player</h3>
        <div class="stats-grid">
            <div class="stat-card">Clicks: <div id="score" style="color:var(--gold); font-size:1.2rem">0</div></div>
            <div class="stat-card">Auto: <div id="auto-count" style="color:var(--accent); font-size:1.2rem">0</div></div>
        </div>
        
        <button id="game-btn">CLICK!</button>
        
        <button id="buy-auto" style="background: #27ae60">Upgrade Auto (Cost: <span id="cost">10</span>)</button>

        <div class="lb-container">
            <table>
                <thead><tr><th>#</th><th>Player</th><th>Score</th></tr></thead>
                <tbody id="lb-body"></tbody>
            </table>
        </div>
        <button onclick="logout()" style="background:var(--danger); margin-top:20px; font-size:0.7rem; padding:8px">Logout</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, update, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwg2ZSpQspAD-o19AZCOHcrl9VnYc_sdk",
            authDomain: "vraj-clicker-2.firebaseapp.com",
            projectId: "vraj-clicker-2",
            storageBucket: "vraj-clicker-2.firebasestorage.app",
            messagingSenderId: "162243172716",
            appId: "1:162243172716:web:874a1f8be471a9f0d83b49",
            measurementId: "G-SBJ4W7JRRL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let userData = { score: 0, autoClickers: 0, name: "" };

        // Helper: Switch Screens
        window.showScreen = (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };

        // Helper: Custom Alert
        function notify(msg) {
            const el = document.getElementById('game-alert');
            el.innerText = msg;
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 3000);
        }

        // --- AUTH ---
        document.getElementById('btn-do-signup').onclick = () => {
            const user = document.getElementById('sign-user').value;
            const email = document.getElementById('sign-email').value;
            const pass = document.getElementById('sign-pass').value;
            if(user.length < 2) return notify("Username too short!");

            createUserWithEmailAndPassword(auth, email, pass).then((cred) => {
                sendEmailVerification(cred.user);
                set(ref(db, 'users/' + cred.user.uid), { name: user, score: 0, autoClickers: 0 });
                notify("Verify your email now!");
            }).catch(e => notify(e.message));
        };

        document.getElementById('btn-do-login').onclick = () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            signInWithEmailAndPassword(auth, email, pass).catch(e => notify("Login Failed"));
        };

        document.getElementById('btn-check-verify').onclick = () => {
            auth.currentUser.reload().then(() => {
                if(auth.currentUser.emailVerified) location.reload();
                else notify("Still not verified!");
            });
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                if (user.emailVerified) {
                    showScreen('screen-game');
                    onValue(ref(db, 'users/' + user.uid), (snap) => {
                        if(snap.exists()) { userData = snap.val(); updateUI(); }
                    });
                } else { showScreen('screen-verify'); }
            } else { showScreen('screen-menu'); }
        });

        // --- GAMEPLAY ---
        document.getElementById('game-btn').onclick = () => {
            userData.score += 1;
            saveData();
        };

        document.getElementById('buy-auto').onclick = () => {
            let cost = Math.floor(10 * Math.pow(1.5, userData.autoClickers));
            if(userData.score >= cost) {
                userData.score -= cost;
                userData.autoClickers += 1;
                saveData();
                notify("Auto-Clicker Bought!");
            } else { notify("Need more clicks!"); }
        };

        function saveData() {
            if(auth.currentUser && auth.currentUser.emailVerified) {
                update(ref(db, 'users/' + auth.currentUser.uid), userData);
            }
        }

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(userData.score);
            document.getElementById('auto-count').innerText = userData.autoClickers;
            document.getElementById('cost').innerText = Math.floor(10 * Math.pow(1.5, userData.autoClickers));
            document.getElementById('display-name').innerText = userData.name;
        }

        // Leaderboard
        const lbRef = query(ref(db, 'users'), orderByChild('score'), limitToLast(10));
        onValue(lbRef, (snap) => {
            const tbody = document.getElementById('lb-body');
            tbody.innerHTML = "";
            let items = [];
            snap.forEach(c => items.push(c.val()));
            items.reverse().forEach((p, i) => {
                tbody.innerHTML += `<tr class="${i==0?'rank-1':''}"><td>${i+1}</td><td>${p.name}</td><td>${Math.floor(p.score)}</td></tr>`;
            });
        });

        window.logout = () => signOut(auth).then(() => location.reload());

        setInterval(() => {
            if(auth.currentUser?.emailVerified && userData.autoClickers > 0) {
                userData.score += (userData.autoClickers * 0.1);
                saveData();
            }
        }, 1000);
    </script>
</body>
</html>
